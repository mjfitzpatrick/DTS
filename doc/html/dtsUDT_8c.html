<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>DTS: dtsUDT.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dtsUDT.c File Reference</h1><a class="el" href="structDTS.html">DTS</a> UDT transfer routines.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;pthread.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;netdb.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;sys/errno.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;netinet/tcp.h&gt;</code><br>
<code>#include &lt;arpa/inet.h&gt;</code><br>
<code>#include &quot;dts.h&quot;</code><br>
<code>#include &quot;dtsUDT.h&quot;</code><br>
<code>#include &quot;dtsPSock.h&quot;</code><br>
<code>#include &quot;udtc.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ad55e154f3cb5a056bb9e07d7b52cb37"></a><!-- doxytag: member="dtsUDT.c::_PTCP_SRC_" ref="ad55e154f3cb5a056bb9e07d7b52cb37" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>_PTCP_SRC_</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="25638b2e5b013d286aed09c9978e394b"></a><!-- doxytag: member="dtsUDT.c::UDT_DEBUG" ref="25638b2e5b013d286aed09c9978e394b" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>UDT_DEBUG</b>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="15816ad43ecbc0876a738652e4a866a2"></a><!-- doxytag: member="dtsUDT.c::USE_PTHREAD_JOIN" ref="15816ad43ecbc0876a738652e4a866a2" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>USE_PTHREAD_JOIN</b></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#e682abbad70a71cf6a836e5cae408ca6">udtSpawnThreads</a> (void *worker, int nthreads, char *dir, char *fname, long fsize, int mode, int rate, int port, char *host, int verbose, pthread_t *tids)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Spawn a worker thread for the transfer.  <a href="#e682abbad70a71cf6a836e5cae408ca6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#9fbe12a60574ef9f7e05f74fe3c2f8d9">udtCollectThreads</a> (int nthreads, pthread_t *tids)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Collect worker threads for the transfer.  <a href="#9fbe12a60574ef9f7e05f74fe3c2f8d9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#50349f4c5c05a5ba807b7e4ab36cc6df">udtSendFile</a> (void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a file to a remote <a class="el" href="structDTS.html">DTS</a>.  <a href="#50349f4c5c05a5ba807b7e4ab36cc6df"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#cf6dc5be78f72753c0a2133b1c810262">udtReceiveFile</a> (void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a file from a remote <a class="el" href="structDTS.html">DTS</a>.  <a href="#cf6dc5be78f72753c0a2133b1c810262"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#d8c34719bb2b37d8352267f0f986b42c">udtSendStripe</a> (int sock, unsigned char *dbuf, long offset, int tnum, long maxbytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Do actual transfer of data stripe to the socket.  <a href="#d8c34719bb2b37d8352267f0f986b42c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#b66429cb336e0f433ec57e781ec35885">udtReceiveStripe</a> (int sock, long offset, int tnum)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read data stripe from the socket connection.  <a href="#b66429cb336e0f433ec57e781ec35885"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e75a00414fad8bc81ece1f139508a440"></a><!-- doxytag: member="dtsUDT.c::udtComputeStripe" ref="e75a00414fad8bc81ece1f139508a440" args="(long fsize, int nthreads, int tnum, long *chsize, long *start, long *end)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>udtComputeStripe</b> (long fsize, int nthreads, int tnum, long *chsize, long *start, long *end)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#64bf8b572c913b0dd7971b5308e1f6db">udt_mutex</a> = PTHREAD_MUTEX_INITIALIZER</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dtsUDT_8c.html#3e00d252a58a2aae580ca08e990104ee">udt_checksum_policy</a> = CS_NONE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bc3bb7a68b2cea3f7db95cb764bce904"></a><!-- doxytag: member="dtsUDT.c::io_tv" ref="bc3bb7a68b2cea3f7db95cb764bce904" args="" -->
struct timeval&nbsp;</td><td class="memItemRight" valign="bottom"><b>io_tv</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4e3d0548c599124f2df64c499a8b0ee6"></a><!-- doxytag: member="dtsUDT.c::queue_delay" ref="4e3d0548c599124f2df64c499a8b0ee6" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>queue_delay</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e9c89e7ff1fbfe74ed32f3bb6b69193f"></a><!-- doxytag: member="dtsUDT.c::thread_sem" ref="e9c89e7ff1fbfe74ed32f3bb6b69193f" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>thread_sem</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="99390fcf722f24689439904d1b546dce"></a><!-- doxytag: member="dtsUDT.c::dts" ref="99390fcf722f24689439904d1b546dce" args="" -->
<a class="el" href="structDTS.html">DTS</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><b>dts</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bfe1ab56be631e48e5edc9f0f1381486"></a><!-- doxytag: member="dtsUDT.c::first_write" ref="bfe1ab56be631e48e5edc9f0f1381486" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>first_write</b></td></tr>

</table>
<hr><h2>Detailed Description</h2>
<a class="el" href="structDTS.html">DTS</a> UDT transfer routines. 
<p>
DTSUDT.C -- <a class="el" href="structDTS.html">DTS</a> UDT transfer routines.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Mike Fitzpatrick, Travis Semple, NOAO </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>3/10/13 </dd></dl>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9fbe12a60574ef9f7e05f74fe3c2f8d9"></a><!-- doxytag: member="dtsUDT.c::udtCollectThreads" ref="9fbe12a60574ef9f7e05f74fe3c2f8d9" args="(int nthreads, pthread_t *tids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udtCollectThreads           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nthreads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t *&nbsp;</td>
          <td class="paramname"> <em>tids</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Collect worker threads for the transfer. 
<p>
UDTCOLLECTTHREADS -- Collect the worker threads for the transfer. Our onl job here is start a thread to rejoin the previously createed threads.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nthreads</em>&nbsp;</td><td>number of threads to create </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tids</em>&nbsp;</td><td>thread IDs </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>status code </dd></dl>

</div>
</div><p>
<a class="anchor" name="cf6dc5be78f72753c0a2133b1c810262"></a><!-- doxytag: member="dtsUDT.c::udtReceiveFile" ref="cf6dc5be78f72753c0a2133b1c810262" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">udtReceiveFile           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a file from a remote <a class="el" href="structDTS.html">DTS</a>. 
<p>
UDTRECEIVEFILE -- Receive a file from a remote <a class="el" href="structDTS.html">DTS</a>.<p>
This function can be called to read a portion of a file from a remote host. Arguments are passed in through a generic 'data' pointer to the psArg struct defined for this 'stripe' of the data.<p>
In this procedure, we act as a client in the connection, i.e. the transfer won't begin until we connect to a remote server sending the data.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>caller thread data </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>References <a class="el" href="dtsFileUtil_8c_source.html#l00141">dts_fileOpen()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00398">dts_fileWrite()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00608">dts_makePath()</a>, <a class="el" href="dtsSockUtil_8c_source.html#l00414">dts_openUDTClientSocket()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00207">dts_preAlloc()</a>, <a class="el" href="dtsSandbox_8c_source.html#l00042">dts_sandboxPath()</a>, <a class="el" href="dtsSem_8c_source.html#l00219">dts_semDecr()</a>, <a class="el" href="dtsLog_8c_source.html#l00301">dtsErrLog()</a>, <a class="el" href="dtsLog_8c_source.html#l00069">dtsLog()</a>, <a class="el" href="dtsLog_8c_source.html#l00362">dtsTimeLog()</a>, <a class="el" href="dtsUDT_8c_source.html#l00043">udt_mutex</a>, and <a class="el" href="dtsUDT_8c_source.html#l00696">udtReceiveStripe()</a>.</p>

<p>Referenced by <a class="el" href="dtsPull_8c_source.html#l00107">dts_xferPullFile()</a>, and <a class="el" href="dtsPush_8c_source.html#l00370">dts_xferReceiveFile()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b66429cb336e0f433ec57e781ec35885"></a><!-- doxytag: member="dtsUDT.c::udtReceiveStripe" ref="b66429cb336e0f433ec57e781ec35885" args="(int sock, long offset, int tnum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uchar * udtReceiveStripe           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tnum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read data stripe from the socket connection. 
<p>
UDTRECEIVESTRIPE -- Do the actual transfer of the data stripe to the client connection. A 'stripe' of data is actually transferred in much smaller 'chunks' which can be tuned to be optimal for the given connection. The checksum policy allows us to perform a checksum of the data either for the entire stripe, or for each individual chunk. The former is generally more efficient as it involves fewer round-trips to the client (i.e. send the checksum and wait for verification before sending next chunk). File-level checksum policy is enforced by our parent.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>socket descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>file offset for this stripe </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tnum</em>&nbsp;</td><td>thread (i.e. stripe) number</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a pointer to the data read </dd></dl>

<p>References <a class="el" href="dtsUtil_8c_source.html#l01319">dts_debugLevel()</a>, <a class="el" href="dtsSockUtil_8c_source.html#l00735">dts_udtRead()</a>, and <a class="el" href="dtsLog_8c_source.html#l00069">dtsLog()</a>.</p>

<p>Referenced by <a class="el" href="dtsUDT_8c_source.html#l00403">udtReceiveFile()</a>.</p>

</div>
</div><p>
<a class="anchor" name="50349f4c5c05a5ba807b7e4ab36cc6df"></a><!-- doxytag: member="dtsUDT.c::udtSendFile" ref="50349f4c5c05a5ba807b7e4ab36cc6df" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">udtSendFile           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a file to a remote <a class="el" href="structDTS.html">DTS</a>. 
<p>
UDTSENDFILE -- Send a file to a remote <a class="el" href="structDTS.html">DTS</a> using UDT.<p>
This function can be called to send a portion of a file to a remote host. Arguments are passed in through a generic 'data' pointer to the psArg struct defined for this 'stripe' of the data.<p>
In this procedure, we act as a server, i.e. we open the specified tcp/ip socket and wait for a client connection before beginning any transfer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>caller thread data </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>References <a class="el" href="dtsFileUtil_8c_source.html#l00172">dts_fileClose()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00141">dts_fileOpen()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00363">dts_fileRead()</a>, <a class="el" href="dtsFileUtil_8c_source.html#l00608">dts_makePath()</a>, <a class="el" href="dtsSockUtil_8c_source.html#l00414">dts_openUDTClientSocket()</a>, <a class="el" href="dtsSandbox_8c_source.html#l00042">dts_sandboxPath()</a>, <a class="el" href="dtsSem_8c_source.html#l00219">dts_semDecr()</a>, <a class="el" href="dtsLog_8c_source.html#l00301">dtsErrLog()</a>, <a class="el" href="dtsLog_8c_source.html#l00069">dtsLog()</a>, <a class="el" href="dtsLog_8c_source.html#l00362">dtsTimeLog()</a>, <a class="el" href="dtsUDT_8c_source.html#l00043">udt_mutex</a>, and <a class="el" href="dtsUDT_8c_source.html#l00618">udtSendStripe()</a>.</p>

<p>Referenced by <a class="el" href="dtsPush_8c_source.html#l00108">dts_xferPushFile()</a>, and <a class="el" href="dtsPull_8c_source.html#l00358">dts_xferSendFile()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d8c34719bb2b37d8352267f0f986b42c"></a><!-- doxytag: member="dtsUDT.c::udtSendStripe" ref="d8c34719bb2b37d8352267f0f986b42c" args="(int sock, unsigned char *dbuf, long offset, int tnum, long maxbytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udtSendStripe           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>dbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tnum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>maxbytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Do actual transfer of data stripe to the socket. 
<p>
UDTSENDSTRIPE -- Do the actual transfer of the data stripe to the client connection. A 'stripe' of data is actually transferred in much smaller 'chunks' which can be tuned to be optimal for the given connection. The checksum policy allows us to perform a checksum of the data either for the entire stripe, or for each individual chunk. The former is generally more efficient as it involves fewer round-trips to the client (i.e. send the checksum and wait for verification before sending next chunk). File-level checksum policy is enforced by our parent.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sock</em>&nbsp;</td><td>socket descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dbuf</em>&nbsp;</td><td>data buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>offset</em>&nbsp;</td><td>file offset for this stripe </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tnum</em>&nbsp;</td><td>thread number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxbytes</em>&nbsp;</td><td>max bytes to transfer</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of chunks sent </dd></dl>

<p>References <a class="el" href="dtsUtil_8c_source.html#l01319">dts_debugLevel()</a>, <a class="el" href="dtsSockUtil_8c_source.html#l00802">dts_udtWrite()</a>, <a class="el" href="dtsLog_8c_source.html#l00301">dtsErrLog()</a>, and <a class="el" href="dtsLog_8c_source.html#l00362">dtsTimeLog()</a>.</p>

<p>Referenced by <a class="el" href="dtsUDT_8c_source.html#l00216">udtSendFile()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e682abbad70a71cf6a836e5cae408ca6"></a><!-- doxytag: member="dtsUDT.c::udtSpawnThreads" ref="e682abbad70a71cf6a836e5cae408ca6" args="(void *worker, int nthreads, char *dir, char *fname, long fsize, int mode, int rate, int port, char *host, int verbose, pthread_t *tids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udtSpawnThreads           </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>worker</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nthreads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>fsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t *&nbsp;</td>
          <td class="paramname"> <em>tids</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Spawn a worker thread for the transfer. 
<p>
UDTSPAWNTHREADS -- Spawn a worker thread for the transfer. All we do here is start a thread to run the function passed in. This may be used to either read or write the data.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>worker</em>&nbsp;</td><td>worker function </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nthreads</em>&nbsp;</td><td>number of threads to create </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dir</em>&nbsp;</td><td>working directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fname</em>&nbsp;</td><td>file name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fsize</em>&nbsp;</td><td>file size </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>transfer mode (push or pull) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rate</em>&nbsp;</td><td>transfer rate (Mbps) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>client base port number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>host</em>&nbsp;</td><td>client host name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>verbose</em>&nbsp;</td><td>verbose output flag </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tids</em>&nbsp;</td><td>thread id array</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>status code </dd></dl>

<p>References <a class="el" href="dtsLog_8c_source.html#l00301">dtsErrLog()</a>, and <a class="el" href="dtsPSock_8c_source.html#l00929">psComputeStripe()</a>.</p>

<p>Referenced by <a class="el" href="dtsPull_8c_source.html#l00107">dts_xferPullFile()</a>, <a class="el" href="dtsPush_8c_source.html#l00108">dts_xferPushFile()</a>, <a class="el" href="dtsPush_8c_source.html#l00370">dts_xferReceiveFile()</a>, and <a class="el" href="dtsPull_8c_source.html#l00358">dts_xferSendFile()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="3e00d252a58a2aae580ca08e990104ee"></a><!-- doxytag: member="dtsUDT.c::udt_checksum_policy" ref="3e00d252a58a2aae580ca08e990104ee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="dtsUDT_8c.html#3e00d252a58a2aae580ca08e990104ee">udt_checksum_policy</a> = CS_NONE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
FIXME -- CS_STRIPE and CS_PACKET not working...... 
<p>Referenced by <a class="el" href="dtsSockUtil_8c_source.html#l00735">dts_udtRead()</a>, and <a class="el" href="dtsSockUtil_8c_source.html#l00802">dts_udtWrite()</a>.</p>

</div>
</div><p>
<a class="anchor" name="64bf8b572c913b0dd7971b5308e1f6db"></a><!-- doxytag: member="dtsUDT.c::udt_mutex" ref="64bf8b572c913b0dd7971b5308e1f6db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="dtsUDT_8c.html#64bf8b572c913b0dd7971b5308e1f6db">udt_mutex</a> = PTHREAD_MUTEX_INITIALIZER          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Mutex lock for thread startup to protect file I/O. 
<p>Referenced by <a class="el" href="dtsUDT_8c_source.html#l00403">udtReceiveFile()</a>, and <a class="el" href="dtsUDT_8c_source.html#l00216">udtSendFile()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Apr 11 11:51:12 2014 for DTS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
